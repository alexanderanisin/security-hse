# S05 - Матрица вариантов (Option Matrix) для R-02

---

## 0) Контекст риска (из S04)

* **Risk-ID:** `R-02`     **Threat:** `T`
* **DFD element/edge:** Ребро: Шлюз API → Сервис (`/api/auth/register`)
* **NFR link (ID):** `NFR-002`
* **L×I (1-5):** `L=3, I=5, Score=15`
* **Ограничения/предпосылки:** Эндпоинт регистрации критичен для безопасности и является публично доступным.

---

## 1) Критерии и шкалы (1-5)

**Польза (↑):**

* **Security impact:** Насколько альтернатива снижает риск.
* **Blast radius reduction:** Насколько сужает возможный ущерб.

**Стоимость/сложность (↓):**

* **Complexity:** Сложность внедрения.
* **Time-to-mitigate:** Время до эффекта.
* **Dependencies:** Внешние/внутренние зависимости.

---

## 2) Таблица сравнения вариантов

| Alternative | Summary (1-2 фразы) | Security impact (↑,1-5) | Blast radius reduction (↑,1-5) | Complexity (↓,1-5) | Time-to-mitigate (↓,1-5) | Dependencies (↓,1-5) | **Benefit** | **Cost** | **Net** | Notes |
| ----------- | ------------------- | ----------------------: | -----------------------------: | -----------------: | -----------------------: | -------------------: | ----------: | -------: | ------: | ----- |
| A | **Server-Side Validation.** Реализация строгой валидации email и пароля в коде сервиса аутентификации. | 5 | 4 | 2 | 1 | 1 | **9** | **4** | **+5** | Быстро и эффективно для конкретного эндпоинта. |
| B | **Client-Side Validation Only.** Полагаться только на проверки в браузере (JavaScript). | 1 | 1 | 1 | 1 | 1 | **2** | **3** | **-1** | Небезопасно, легко обходится. Не является решением. |

---

## 3) Тай-брейкеры при равенстве Net

Не требуется.

---

## 4) Решение (для переноса в ADR)

* **Chosen alternative:** `A`
* **Почему:** Валидация на стороне сервера (Alternative A) является единственным надежным способом защиты от невалидных данных при регистрации. Она обеспечивает полный контроль над данными, поступающими в систему, в отличие от клиентской валидации, которую легко обойти.
* **ADR candidate (название):** `User Registration Input Validation`
* **Связки:** Risk-ID `R-02`, NFR-ID `NFR-002`, DFD `Шлюз API → Сервис`
* **Следующие шаги (минимум):**
    * Реализовать проверку email на соответствие RFC5322.
    * Реализовать проверку пароля на сложность (длина, символы).
    * Обеспечить возврат `400 Bad Request` с RFC7807 при ошибках.
