# S04 - Приоритизация рисков L×I (risk scoring)

## Таблица приоритизации

| Risk ID | Source (DFD/Row)            | Consolidated Description                                                        | Threat (S/T/R/I/D/E) | NFR link (ID)    | L (1-5) | Rationale-L                                                                | I (1-5) | Rationale-I                                                             | **Score (=L×I)** | Decision (Top-5?) | ADR candidate                          |
| ------- | --------------------------- | ------------------------------------------------------------------------------- | -------------------- | ---------------- | ------: | -------------------------------------------------------------------------- | ------: | ----------------------------------------------------------------------- | ---------------: | ----------------- | -------------------------------------- |
| R-01    | Ребро: Интернет → Шлюз API  | Подделка личности пользователя через украденные или повторно использованные JWT | S                    | NFR-012          |       4 | Публичная поверхность API, распространенные уязвимости JWT                 |       5 | Полный несанкционированный доступ к данным и действиям пользователя     |               20 | Топ-1             | SSO                                    |
| R-02    | Ребро: Шлюз API → Сервис    | Подделка пользовательского ввода, приводящая к инъекционным атакам              | T                    | NFR-002, NFR-005 |       3 | Валидация ввода может быть обойдена, если она нестрогая, но требует знаний |       5 | Потенциальное повреждение данных или компрометация системы              |               15 | Топ-2             | Input Sanitization + ORM               |
| R-03    | Узел: Сервис                | Повышение привилегий через редактирование JWT (когда JWT хранит роли, например) | E                    | NFR-012          |       3 | Требует использования недостатков аутентификации, нетривиально             |       5 | Повышение до прав администратора, полный контроль                       |               15 | Топ-3             | JWT stores only user_id and expiration |
| R-04    | Ребро: Сервис → База данных | Раскрытие PII в логах или ответах об ошибках                                    | I                    | NFR-004          |       3 | Логи могут раскрывать данные, если не маскируются, умеренное обнаружение   |       4 | Нарушение конфиденциальности, штрафы GDPR, потеря доверия пользователей |               12 | Топ-4             | PII Masking in Logs                    |
| R-05    | Ребро: Интернет → Шлюз API  | Отказ в обслуживании из-за обхода ограничения скорости при регистрации/поиске   | D                    | NFR-003, NFR-008 |       4 | Публичные конечные точки, легко зафлудить ботами                           |       3 | Замедление работы сервиса, увеличение затрат                            |               12 | Топ-5             | Enhanced Rate Limiting + CAPTCHA       |
| R-06    | Ребро: Сервис → Внешний     | Отказ в обслуживании из-за сбоя внешней зависимости (email/captcha)             | D                    | NFR-011          |       3 | Внешние сервисы могут отказать, средняя частота                            |       4 | Блокировка регистрации/поиска, разочарование пользователей              |               12 | -                 | Circuit Breaker for External APIs      |
| R-07    | Узел: База данных           | Отказ от действий пользователя из-за отсутствия аудиторских логов               | R                    | NFR-010          |       2 | Редко, требует инсайдерского доступа или подделки логов                    |       3 | Сложность в реагировании на инциденты, юридические проблемы             |                6 | -                 | Audit Logging for DB Operations        |

## Сводка Toп-5

1. `R-01` - Высокая вероятность из-за публичного API и распространенных проблем с JWT, критический ущерб от полного несанкционированного доступа; ADR: JWT TTL + Refresh Token.
2. `R-02` - Средняя вероятность из-за недостатков ввода, критический ущерб от компрометации через инъекцию; ADR: Input Sanitization + ORM.
3. `R-03` - Средняя вероятность из-за эксплойтов аутентификации, критический ущерб от повышения привилегий; ADR: RBAC Enforcement + Audit.
4. `R-04` - Средняя вероятность из-за утечек в логах, высокий ущерб от нарушений конфиденциальности; ADR: PII Masking in Logs.
5. `R-05` - Высокая вероятность из-за публичного флуда, значительный ущерб от DoS; ADR: Enhanced Rate Limiting + CAPTCHA.
