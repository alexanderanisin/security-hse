# S04 - STRIDE per element (матрица)

## Матрица для заполнения

| Element                            | Data/Boundary              | Threat (S/T/R/I/D/E) | Description                                                     | NFR link (ID)             | Mitigation idea (ADR later)                              |
| ---------------------------------- | -------------------------- | -------------------- | --------------------------------------------------------------- | ------------------------- | -------------------------------------------------------- |
| Ребро: Клиент → Шлюз API           | JWT/HTTPS                  | S                    | Повторное использование украденных или просроченных JWT токенов | NFR-012                   | JWT TTL + Refresh Token                                  |
| Ребро: Клиент → Шлюз API           | JWT/HTTPS                  | T                    | Изменение полезной нагрузки или заголовков JWT                  | NFR-012                   | Проверка подписи JWT                                     |
| Ребро: Клиент → Шлюз API           | JWT/HTTPS                  | I                    | Раскрытие JWT в логах или сообщениях об ошибках                 | NFR-004          | Маскирование PII в логах                                 |
| Ребро: Клиент → Шлюз API           | JWT/HTTPS                  | D                    | Флуд недействительными запросами в обход ограничения скорости   | NFR-003, NFR-008, NFR-012 | Улучшенное ограничение скорости + CAPTCHA                |
| Ребрo: Шлюз API → Сервис           | DTO/Запросы                | T                    | Атаки-инъекции через неочищенный ввод                           | NFR-002, NFR-005          | Очистка + Валидация ввода                                |
| Ребро: Шлюз API → Сервис           | DTO/Запросы                | I                    | Утечка конфиденциальных данных в логах запросов                 | NFR-004                   | Маскирование при логировании запросов                    |
| Ребро: Шлюз API → Сервис           | DTO/Запросы                | D                    | Истощение ресурсов из-за больших полезных нагрузок              | NFR-005                   | Ограничение размера полезной нагрузки                    |
| Ребро: Сервис → База данных        | SQL/ORM                    | T                    | SQL-инъекция или подделка данных                                | NFR-009                   | Параметризованные запросы + ORM                          |
| Ребро: Сервис → База данных        | SQL/ORM                    | I                    | Учетные данные базы данных или результаты запросов в логах      | NFR-004                   | Безопасное логирование + Шифрование                      |
| Ребро: Сервис → База данных        | SQL/ORM                    | R                    | Отсутствие аудиторских следов для операций с БД                 | NFR-010                   | Аудиторское логирование БД                               |
| Ребро: Сервис → Файловое хранилище | Файл/Бинарный (внутренний) | T                    | Загрузка вредоносных файлов (вредоносное ПО, веб-шеллы)         | NFR-005                   | Сканирование типа/содержимого файла, Ограничение размера |
| Ребро: Сервис → Файловое хранилище | Файл/Бинарный (внутренний) | D                    | Истощение ресурсов из-за чрезмерных загрузок                    | NFR-006                   | Квоты на пользователя, Ограничение скорости              |
| Ребро: Сервис → Внешний            | SMTP/API                   | D                    | Подвисание запросов без тайм-аутов                              | NFR-011                   | Тайм-аут + Повторные попытки + Circuit Breaker           |
| Ребро: Сервис → Внешний            | SMTP/API                   | I                    | Утечка ключей API или ответов в логах                           | NFR-004                   | Управление внешними ключами API                          |
| Узел: Шлюз API                     | Публичный                  | E                    | Повышение привилегий из-за неправильной маршрутизации           | NFR-001                   | RBAC на конечных точках API                              |
| Узел: Сервис                       | Бизнес-логика              | E                    | Логические недостатки, допускающие несанкционированные действия | NFR-001                   | Проверки авторизации в коде                              |
| Узел: База данных                  | Хранилище данных           | I                    | Утечки данных из-за незашифрованного хранения                   | NFR-004                   | Шифрование данных при хранении                           |
| Узел: База данных                  | Хранилище данных           | R                    | Отсутствие неизменяемых аудиторских логов для изменений данных  | NFR-010                   | Неизменяемые аудиторские следы                           |
| Узел: Внешний                      | Email                      | D                    | Время простоя внешнего сервиса, блокирующее регистрацию         | NFR-011                   | Механизмы отката                                         |
